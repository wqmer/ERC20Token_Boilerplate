
<!DOCTYPE html>

<html>


<head>

  <meta charset="utf-8">


  <script type="text/javascript" src="./lib/jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="./lib/web3.min0_2.js"></script>
  <!-- <script type="text/javascript" src="./lib/web3.min.js"></script> -->
  <script type="text/javascript">
//var token =  require('./Token');




var abi = [
    {
      "constant": true,
      "inputs": [],
      "name": "name",
      "outputs": [
        {
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "totalSupply",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "decimals",
      "outputs": [
        {
          "name": "",
          "type": "uint8"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "",
          "type": "address"
        }
      ],
      "name": "balanceOf",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "symbol",
      "outputs": [
        {
          "name": "",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [
        {
          "name": "",
          "type": "address"
        },
        {
          "name": "",
          "type": "address"
        }
      ],
      "name": "allowance",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "name": "initialSupply",
          "type": "uint256"
        },
        {
          "name": "tokenName",
          "type": "string"
        },
        {
          "name": "decimalUnits",
          "type": "uint8"
        },
        {
          "name": "tokenSymbol",
          "type": "string"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "name": "from",
          "type": "address"
        },
        {
          "indexed": true,
          "name": "to",
          "type": "address"
        },
        {
          "indexed": false,
          "name": "value",
          "type": "uint256"
        }
      ],
      "name": "Transfer",
      "type": "event"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "_to",
          "type": "address"
        },
        {
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "transfer",
      "outputs": [],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "addr",
          "type": "address"
        }
      ],
      "name": "getBalance",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ] ;
var contractaddress = "0x345ca3e014aaf5dca488057592ee47305d9b3e10" ;
var Web3 = require('web3');
var web3 = new Web3();
web3.setProvider(new web3.providers.HttpProvider('http://localhost:7545'));
var DemoToken = web3.eth.contract(abi).at(contractaddress);
var accountOne = web3.eth.accounts[0];
var accountTwo = web3.eth.accounts[1];
//show address
console.log(web3.eth.coinbase);


//check token balance 
var accountOneBalance = DemoToken.getBalance.call(accountOne);
console.log(accountOneBalance.toNumber());

//check eth balance
var EthBalance = web3.fromWei(web3.eth.getBalance(web3.eth.accounts[0]),'ether');
console.log(EthBalance.toNumber());

//send token  
//check txhash

var txhashToken = DemoToken.transfer.sendTransaction(accountTwo, 150000, {from:accountOne});
console.log(txhashToken);

//send eth (withdraw)
//check txhash

var txhashEth = web3.eth.sendTransaction({from: accountOne, to:accountTwo, value: web3.toWei(1, 'ether'), gasLimit: 70000, gasPrice: 20000000000});
console.log(txhashEth);


// todo 
// add 'create a new address' bottom to generate a new address , and get a copy of private key.
// add 'withdraw' bottom to send coin/eth to a new address.
// add 'balance' bottom to check balance.
// add 'check ' botttom to check transaction 


 function watchBalance() {
        var coinbase = web3.eth.coinbase;
        var originalBalance = web3.eth.getBalance(coinbase).toNumber();
        document.getElementById('coinbase').innerText = coinbase;
        document.getElementById('original').innerText = ' original balance: ' + originalBalance ;
        web3.eth.filter('latest').watch(function() {
            var currentBalance = web3.eth.getBalance(coinbase).toNumber();
            //document.getElementById("current").innerText = 'current: ' + currentBalance;
            //document.getElementById("diff").innerText = 'diff:    ' + (currentBalance - originalBalance);
        });
    }




</script>


</head>


<body>

    <h1>ETH/ERC20 SIMPLE WALLET</h1>
   
    <h2>list all address here</h2> 
    <ol id="addresslist"  ></ol>
    <!-- generate a new address and pop-up a private key  -->
    <button id = "newaddress">new address</button>

    <!-- input a address and onClick to check balance  -->
    <h2>input a address here</h2>
  
    <button id="balance">balance</button>

     <!-- input a new address , amount ,and type of coun . OnClick to send .Add a anohter bottom to check status-->
    <h2>input the orginal address and destination address here</h2>
    <button type="button" onClick="watchBalance();">withdraw</button>  <button type="button" onClick="watchBalance();">transaction status</button>

    
    
   
    <div id="current"></div>
    <div id="diff"></div>

    <script src="./lib/jquery-3.3.1.min.js"></script>
    <script src="./generate.js"></script>

</body>



</html>